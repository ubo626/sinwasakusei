<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ç¥è©±æŠ•ç¨¿ã‚µã‚¤ãƒˆï¼ˆè©¦ä½œï¼‰</title>
<style>
  :root{
    --bg:#ffffff;
    --text:#0b0b0b;
    --muted:#777;
    --accent:#111;
    --card:#fafafa;
    --accent-2:#f2f2f2;
    --danger:#d9534f;
    --ok:#28a745;
    font-family: -apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{background:var(--bg); color:var(--text); margin:0; padding:0; -webkit-font-smoothing:antialiased;}
  .wrap{max-width:900px; margin:0 auto; padding:16px; box-sizing:border-box;}
  header{display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:12px;}
  h1{font-size:18px; margin:0;}
  .sub{font-size:12px; color:var(--muted);}
  .controls{display:flex; gap:8px; align-items:center;}
  button, input[type="button"], input[type="submit"]{background:transparent; border:1px solid var(--accent); padding:8px 10px; border-radius:8px; font-size:14px;}
  button.primary{background:var(--accent); color:white; border-color:transparent;}
  form.card{background:var(--card); padding:12px; border-radius:12px; box-shadow: 0 1px 0 rgba(0,0,0,0.04);}
  label{display:block; font-size:13px; margin-bottom:6px; color:var(--muted);}
  textarea, input[type="text"], input[type="file"]{width:100%; box-sizing:border-box; padding:10px; border-radius:8px; border:1px solid var(--accent-2); background:white; font-size:14px; margin-bottom:10px;}
  textarea{min-height:120px; resize:vertical;}
  .row{display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
  .small{font-size:13px; color:var(--muted);}
  .posts{margin-top:14px; display:flex; flex-direction:column; gap:12px;}
  .post{background:white; border:1px solid var(--accent-2); padding:12px; border-radius:10px;}
  .post-header{display:flex; justify-content:space-between; gap:8px; align-items:center; margin-bottom:8px;}
  .title{font-weight:600; font-size:15px; margin:0;}
  .meta{font-size:12px; color:var(--muted);}
  .badge{display:inline-flex; align-items:center; gap:6px; background:#eefaf1; color:var(--ok); padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid rgba(40,167,69,0.12);}
  .admin-badge{background:#fff8e6; color:#d97706; border:1px solid rgba(217,151,37,0.12);}
  img.preview{max-width:100%; border-radius:8px; margin-top:8px;}
  .tags{margin-top:8px; display:flex; gap:6px; flex-wrap:wrap;}
  .tag{font-size:12px; color:var(--accent); border:1px dashed var(--accent-2); padding:4px 8px; border-radius:999px; background:transparent;}
  .actions{display:flex; gap:8px; align-items:center;}
  .searchbar{display:flex; gap:8px; margin:10px 0;}
  input[type="search"]{flex:1; padding:10px; border-radius:10px; border:1px solid var(--accent-2);}
  .muted{color:var(--muted); font-size:13px;}
  footer{margin-top:18px; font-size:12px; color:var(--muted);}
  /* small screens */
  @media (max-width:480px){
    h1{font-size:16px;}
    button{padding:8px 10px; font-size:13px;}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>ç©ºæƒ³ç¥è©±ã®åºƒå ´</h1>
        <div class="sub">ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ç¥è©±ã ã‘ã‚’æŠ•ç¨¿ã™ã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ï¼ˆè©¦ä½œï¼‰</div>
      </div>
      <div class="controls">
        <button id="btn-admin">Adminãƒ­ã‚°ã‚¤ãƒ³</button>
        <button id="btn-clear" title="ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã‚’å…¨ã¦æ¶ˆã™ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰">ãƒ‡ãƒ¼ã‚¿æ¶ˆå»</button>
      </div>
    </header>

    <!-- æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form id="postForm" class="card" autocomplete="off">
      <label class="small">ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä»»æ„ï¼‰</label>
      <input id="title" type="text" placeholder="çŸ­ã„ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä¾‹ï¼šé¢¨ã®å¥³ç¥ã®ç‰©èªï¼‰" maxlength="80">

      <label class="small">æœ¬æ–‡ï¼ˆå¿…é ˆï¼šã‚ªãƒªã‚¸ãƒŠãƒ«ã®ç¥è©±ï¼‰</label>
      <textarea id="content" placeholder="ã“ã“ã«ç¥è©±ã®æœ¬æ–‡ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚æ–‡ç« ã ã‘ã§ã‚‚ã€ç”»åƒã ã‘ã§ã‚‚ã€ä¸¡æ–¹ã§ã‚‚å¯ã€‚"></textarea>

      <label class="small">ç”»åƒï¼ˆä»»æ„ï¼‰</label>
      <input id="image" type="file" accept="image/*">

      <label class="small">ã‚¿ã‚°ï¼ˆå¿…é ˆï¼‰ <span class="muted">ã‚«ãƒ³ãƒã§åŒºåˆ‡ã£ã¦è¤‡æ•°æŒ‡å®šå¯ï¼ˆä¾‹: æµ·,å‰µé€ ç¥ï¼‰</span></label>
      <input id="tags" type="text" placeholder="ä¾‹ï¼šæµ·,å‰µé€ ç¥">

      <div class="row" style="margin-top:6px; justify-content:space-between; align-items:center;">
        <label style="display:flex; gap:8px; align-items:center;">
          <input id="confirm-original" type="checkbox" required>
          <span class="small">ç§ã®æŠ•ç¨¿ã¯**ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ç¥è©±**ã§ã‚ã‚Šè‘—ä½œæ¨©ç­‰ã‚’ä¾µå®³ã—ã¦ã„ã¾ã›ã‚“ï¼ˆå¿…é ˆï¼‰</span>
        </label>
        <div style="display:flex; gap:8px;">
          <button type="submit" class="primary">æŠ•ç¨¿ã™ã‚‹</button>
        </div>
      </div>
      <div id="formMsg" class="muted" style="margin-top:8px; font-size:13px;"></div>
      <button onclick="savePost(
  document.getElementById('title').value,
  document.getElementById('content').value,
  document.getElementById('tags').value
)">æŠ•ç¨¿ã™ã‚‹</button>

    </form>

    <!-- æ¤œç´¢ / ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ -->
    <div class="searchbar">
      <input id="q" type="search" placeholder="ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ï¼ˆæœ¬æ–‡ãƒ»ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ï¼‰">
      <input id="tagFilter" type="text" placeholder="ã‚¿ã‚°ã§çµã‚‹ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šå¯ï¼‰">
      <button id="btnFilter">çµã‚Šè¾¼ã‚€</button>
      <button id="btnReset">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
    <div class="muted" id="resultInfo">æŠ•ç¨¿æ•°: 0</div>

    <!-- æŠ•ç¨¿ä¸€è¦§ -->
    <div class="posts" id="posts"></div>

    <footer>
      <div>æ³¨æ„ï¼šã“ã®è©¦ä½œã¯**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®LocalStorageï¼‰ä¸Šã§å‹•ã**ç°¡æ˜“ç‰ˆã§ã™ã€‚å®Ÿéš›ã«å…¬é–‹ãƒ»é‹å–¶ã™ã‚‹å ´åˆã¯ã‚µãƒ¼ãƒãƒ¼å´ã®èªè¨¼ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»æŠ•ç¨¿è¦ç´„ãƒ»ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’å°å…¥ã—ã¦ãã ã•ã„ã€‚</div>
      <div style="margin-top:6px;">ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆè©¦ä½œç”¨ï¼‰: <code>admin</code></div>
    </footer>
  </div>

<script>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>

<script>
  
  // ğŸ”¹ã“ã“ã«ã‚ãªãŸã®firebaseConfigã‚’è²¼ã‚‹
firebaseConfig = {
Â  apiKey: "AIzaSyD18XhUujCSo_ezYyf_rV8crnjBz7Pv1jY",
Â  authDomain: "sinwasakusei.firebaseapp.com",
Â  projectId: "sinwasakusei",
Â  storageBucket: "sinwasakusei.firebasestorage.app",
Â  messagingSenderId: "135038486513",
Â  appId: "1:135038486513:web:1791f88ca12571560ba650",
Â  measurementId: "G-CRQ4R3MTNX"
};

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // æŠ•ç¨¿ã‚’ä¿å­˜ã™ã‚‹é–¢æ•°
  async function savePost(title, content, tags) {
    await db.collection("posts").add({
      title: title,
      content: content,
      tags: tags,
      time: new Date()
    });
  }

  // æŠ•ç¨¿ã‚’èª­ã¿å–ã£ã¦ä¸€è¦§ã«è¡¨ç¤º
  async function loadPosts() {
    const snapshot = await db.collection("posts").orderBy("time", "desc").get();
    const list = document.getElementById("postList");
    list.innerHTML = "";
    snapshot.forEach(doc => {
      const p = doc.data();
      const div = document.createElement("div");
      div.className = "post";
      div.innerHTML = `
        <h3>${p.title}</h3>
        <p>${p.content.slice(0, 100)}...</p>
        <button onclick="showPost('${doc.id}')">è©³ã—ãè¦‹ã‚‹</button>
      `;
      list.appendChild(div);
    });
  }

  // æŠ•ç¨¿ã‚’è©³ã—ãè¡¨ç¤º
  async function showPost(id) {
    const docSnap = await db.collection("posts").doc(id).get();
    const p = docSnap.data();
    alert(`ã€${p.title}ã€‘\n\n${p.content}`);
  }

  loadPosts(); // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¸€è¦§è¡¨ç¤º
</script>
/*
 Simple client-only posting system (LocalStorage)
 - posts are stored as array under localStorage key 'myth_posts'
 - structure: {id, title, content, imageDataUrl|null, tags:[...], created, approved:boolean, author:'user'|'admin'}
 - admin login is client-side (password = 'admin') for demo only
*/

const LS_KEY = 'myth_posts_v1';
let posts = [];
let isAdmin = false;
const adminMark = 'èªå®š';

// DOM
const postsEl = document.getElementById('posts');
const postForm = document.getElementById('postForm');
const titleEl = document.getElementById('title');
const contentEl = document.getElementById('content');
const imageEl = document.getElementById('image');
const tagsEl = document.getElementById('tags');
const confirmEl = document.getElementById('confirm-original');
const formMsg = document.getElementById('formMsg');
const qEl = document.getElementById('q');
const tagFilterEl = document.getElementById('tagFilter');
const resultInfo = document.getElementById('resultInfo');
const btnAdmin = document.getElementById('btn-admin');
const btnClear = document.getElementById('btn-clear');
const btnFilter = document.getElementById('btnFilter');
const btnReset = document.getElementById('btnReset');

function loadPosts(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    posts = raw ? JSON.parse(raw) : [];
  }catch(e){
    posts = [];
  }
}
function savePosts(){
  localStorage.setItem(LS_KEY, JSON.stringify(posts));
}
function renderPosts(filterQ='', filterTags=[]){
  postsEl.innerHTML = '';
  const list = posts.slice().sort((a,b)=> new Date(b.created) - new Date(a.created));
  let shown = 0;
  for(const p of list){
    // filter by q
    const qLower = filterQ.trim().toLowerCase();
    if(qLower){
      const hay = ((p.title||'') + ' ' + (p.content||'')).toLowerCase();
      if(!hay.includes(qLower)) continue;
    }
    // filter by tags (all must be present)
    if(filterTags.length){
      const pTags = (p.tags||[]).map(s=>s.toLowerCase());
      let ok = true;
      for(const ft of filterTags){
        if(!pTags.includes(ft)) { ok = false; break; }
      }
      if(!ok) continue;
    }
    shown++;
    const el = document.createElement('article');
    el.className = 'post';
    el.innerHTML = `
      <div class="post-header">
        <div>
          <div class="title">${escapeHtml(p.title||'ï¼ˆç„¡é¡Œï¼‰')}</div>
          <div class="meta">${new Date(p.created).toLocaleString()}</div>
        </div>
        <div style="text-align:right">
          ${p.approved ? `<span class="badge">${adminMark}</span>` : ''}
          ${p.author === 'admin' ? `<span class="badge admin-badge" style="margin-left:6px">ç®¡ç†è€…æŠ•ç¨¿</span>` : ''}
        </div>
      </div>
      <div class="post-body">
        <div class="content">${linkify(escapeHtml(p.content||''))}</div>
        ${p.imageDataUrl ? `<img class="preview" src="${p.imageDataUrl}" alt="æŠ•ç¨¿ç”»åƒ">` : ''}
        <div class="tags">${(p.tags||[]).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join('')}</div>
        <div style="margin-top:8px;" class="actions">
          ${isAdmin ? (p.approved ? `<button data-id="${p.id}" class="btn-unapprove">æ‰¿èªå–ã‚Šæ¶ˆã—</button>` : `<button data-id="${p.id}" class="btn-approve">æ‰¿èªã™ã‚‹</button>`) : ''}
          ${isAdmin ? `<button data-id="${p.id}" class="btn-delete" style="background:transparent;border:1px solid var(--danger);color:var(--danger)">å‰Šé™¤</button>` : ''}
        </div>
      </div>
    `;
    postsEl.appendChild(el);
  }
  resultInfo.textContent = `æŠ•ç¨¿æ•°: ${posts.length}ï¼ˆè¡¨ç¤º: ${shown}ï¼‰ ${isAdmin ? '(ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰)' : ''}`;
  attachActionHandlers();
}

function attachActionHandlers(){
  // approve buttons
  const approves = document.querySelectorAll('.btn-approve');
  approves.forEach(b=> b.addEventListener('click', e=>{
    const id = b.getAttribute('data-id');
    const p = posts.find(x=>x.id===id);
    if(p){ p.approved = true; savePosts(); renderPosts(qEl.value, parseTagFilter(tagFilterEl.value)); }
  }));
  const unapproves = document.querySelectorAll('.btn-unapprove');
  unapproves.forEach(b=> b.addEventListener('click', e=>{
    const id = b.getAttribute('data-id');
    const p = posts.find(x=>x.id===id);
    if(p){ p.approved = false; savePosts(); renderPosts(qEl.value, parseTagFilter(tagFilterEl.value)); }
  }));
  const deletes = document.querySelectorAll('.btn-delete');
  deletes.forEach(b=> b.addEventListener('click', e=>{
    const id = b.getAttribute('data-id');
    if(!confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿï¼ˆã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼‰')) return;
    posts = posts.filter(x=>x.id!==id);
    savePosts();
    renderPosts(qEl.value, parseTagFilter(tagFilterEl.value));
  }));
}

// helpers
function escapeHtml(s){
  if(!s) return '';
  return s.replace(/[&<>"']/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}
function linkify(text){
  // auto-link URLs
  return text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" rel="noopener">$1</a>').replace(/\n/g,'<br>');
}
function parseTags(s){
  return s.split(',').map(t=>t.trim()).filter(t=>t).slice(0,10);
}
function parseTagFilter(s){
  return s.split(',').map(t=>t.trim().toLowerCase()).filter(t=>t);
}

function uid(){
  return 'p_' + Math.random().toString(36).slice(2,10);
}

// form submit
postForm.addEventListener('submit', async (ev)=>{
  ev.preventDefault();
  formMsg.textContent = '';
  if(!confirmEl.checked){ formMsg.textContent = 'ã€Œã‚ªãƒªã‚¸ãƒŠãƒ«åŒæ„ã€ãƒã‚§ãƒƒã‚¯ãŒå¿…è¦ã§ã™ã€‚'; return; }
  const content = contentEl.value.trim();
  const title = titleEl.value.trim();
  const tags = parseTags(tagsEl.value);
  if(!content && imageEl.files.length===0){ formMsg.textContent = 'æ–‡ç« ã‹ç”»åƒã®ã©ã¡ã‚‰ã‹ã‚’æ·»ãˆã¦ãã ã•ã„ã€‚'; return; }
  if(tags.length===0){ formMsg.textContent = 'ã‚¿ã‚°ã‚’1ã¤ä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'; return; }
  // convert image to dataURL if present
  let dataUrl = null;
  if(imageEl.files.length){
    try{
      dataUrl = await readFileAsDataURL(imageEl.files[0]);
    }catch(e){
      console.error(e);
      formMsg.textContent = 'ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
      return;
    }
  }
  const post = {
    id: uid(),
    title: title,
    content: content,
    imageDataUrl: dataUrl,
    tags: tags,
    created: new Date().toISOString(),
    approved: isAdmin, // if admin posts while logged in -> auto-approved
    author: isAdmin ? 'admin' : 'user'
  };
  posts.push(post);
  savePosts();
  // reset form
  postForm.reset();
  formMsg.textContent = 'æŠ•ç¨¿ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ãƒ»é‹å–¶å´ã®æ‰¿èªãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ï¼‰ã€‚';
  renderPosts(qEl.value, parseTagFilter(tagFilterEl.value));
});

function readFileAsDataURL(file){
  return new Promise((res, rej)=>{
    const r = new FileReader();
    r.onload = ()=> res(r.result);
    r.onerror = ()=> rej(new Error('read error'));
    r.readAsDataURL(file);
  });
}

// admin login
btnAdmin.addEventListener('click', ()=>{
  if(isAdmin){
    if(confirm('ç®¡ç†è€…ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
      isAdmin = false;
      btnAdmin.textContent = 'Adminãƒ­ã‚°ã‚¤ãƒ³';
      renderPosts(qEl.value, parseTagFilter(tagFilterEl.value));
    }
    return;
  }
  const pass = prompt('ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆè©¦ä½œ: adminï¼‰');
  if(pass === 'admin'){
    isAdmin = true;
    btnAdmin.textContent = 'Adminãƒ­ã‚°ã‚¢ã‚¦ãƒˆ';
    alert('ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚Šã¾ã—ãŸï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆèªè¨¼ã®ã¿ãƒ»æœ¬ç•ªã§ã¯ã‚µãƒ¼ãƒãƒ¼èªè¨¼ãŒå¿…è¦ï¼‰');
    renderPosts(qEl.value, parseTagFilter(tagFilterEl.value));
  } else {
    alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™');
  }
});

// clear local data (for testing)
btnClear.addEventListener('click', ()=>{
  if(confirm('ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚ŒãŸå…¨ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆå»ã—ã¾ã™ã‹ï¼Ÿï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰')){
    localStorage.removeItem(LS_KEY);
    loadPosts();
    renderPosts();
  }
});

// filter buttons
btnFilter.addEventListener('click', ()=> {
  const q = qEl.value || '';
  const ft = parseTagFilter(tagFilterEl.value);
  renderPosts(q, ft);
});
btnReset.addEventListener('click', ()=> {
  qEl.value = '';
  tagFilterEl.value = '';
  renderPosts();
});

// initial load
loadPosts();
renderPosts();

// small utility: seed sample content if no posts (optional)
if(posts.length===0){
  const seed = {
    id: uid(),
    title: 'é¢¨ã®å¥³ç¥ã®åˆå”±',
    content: 'ã‹ã¤ã¦é¢¨ã®å¥³ç¥ã¯æµ·ã«å”„ã‚’è½ã¨ã—ãŸã€‚ä¸–ç•ŒãŒç”Ÿã¾ã‚Œã‚‹ãã®å‰ã®ç‰©èªâ€¦',
    imageDataUrl: null,
    tags: ['é¢¨','å‰µé€ ç¥'],
    created: new Date().toISOString(),
    approved: true,
    author: 'admin'
  };
  posts.push(seed);
  savePosts();
  renderPosts();
}
</script>
</body>
</html>